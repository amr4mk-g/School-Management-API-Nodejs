require('dotenv').config()

const Cortex          = require('../index');

// (async()=>{

const cortex = new Cortex({
    prefix: "ionx",
    url: "redis://127.0.0.1:6379",
    type: 'tester',
    activeDelay: "5",
    idleDelay: "5"
});

// console.log(cortex)

//     cortex.sub("_fojo_", (d)=>{
//             console.log(`ðŸ‘¯`,d);
//         }
//     );

    // cortex.sub("nested.*",(d, meta, cb)=>{
    //     if(d.error){
    //         console.log(d.error);
    //     }
    //     console.log('got meta', meta);
       
    //     let value = 0;
    //     if(!d.numbers){
    //         throw Error(`missing number`);
    //     } else {
    //         d.numbers.forEach(i=>{
    //             value=value+i});
    //     }
    //     cb({value});
    // }) 

setTimeout(async () => {

    // console.log("ðŸš€ ~ file: test.js:47 ~ setTimeout ~ cortex.nodes:", cortex.nodes)
    // setInterval(()=>{
    // var t0 = performance.now()
    const data = await cortex.AsyncEmitToOneOfFar({
        type: 'tester',
        call: "_fojo_",
        data: {
            numbers: [1, 3, 4],
        }
    },
        (data) => {
            if (data.error) throw Error(data.error);
            console.log(data)
        })
    console.log(data)
    // }, 20);
}, 3000)

    
    
// })();

