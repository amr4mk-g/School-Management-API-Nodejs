require('dotenv').config()
const Cortex = require('../index');

(async()=>{

    const cortexOne = new Cortex({
        prefix: "ionx",
        url: "redis://127.0.0.1:6379",
        type: 'jat',
        state: ()=>{
            return {
                cors: 12
            }
        }
    });

    const cortexTwo = new Cortex({
        prefix: "ionx",
        url: "redis://127.0.0.1:6379",
        type: 'jat',
        state: ()=>{
            return {
                cors: 12
            }
        }
    });

    const cortexThree = new Cortex({
        prefix: "ionx",
        url: "redis://127.0.0.1:6379",
        type: 'jat',
        state: ()=>{
            return {
                cors: 12
            }
        }
    });

    cortexOne.sub("sayHello", async (d, meta, cb) =>{
            console.log(`Hello from C1`);
            return cb(d)
        }
    );

    cortexTwo.sub("sayHello", async (d, meta, cb) =>{
            console.log(`Hello from C2`);
            return cb(d)
        }
    );

    cortexThree.sub("sayHello", async (d, meta, cb) =>{
        console.log(`Hello from C3`);
        return cb(d)
        }
    );
    
    setTimeout(()=>{   
        cortexOne.emitToAllOf({
            type: 'jat',
            call: "sayHello",
            data: {
                ok: true
            }
        }, async (d)=>{
            if(d.error){
                console.log(`ERROR----->`, d.error);
            } else {
                console.log(`RESPONSE---->`, d);
            }
            return
        })
    }, 2000);

})();

