const { parentPort, workerData } = require("worker_threads");
const RedisTimeMachine = require("./sortedSetManager.js");
const debug = require("debug")("Ion-SortedSet:ConsumingThread");

const run = async () => {
	const { url, key, executionkey, timestamp, segmantDuration } = workerData;
	console.log("ğŸš€ ~ file: consuming-thread.js:7 ~ run ~ workerData:", workerData)

	const sortedSetConsumer = new RedisTimeMachine({ url });
	sortedSetConsumer.listenToSortedSet({
		key, timestamp, segmantDuration,
		onData: (result) => {
			console.log("ğŸš€ ~ file: consuming-thread.js:13 ~ run ~ result:", result)
			parentPort.postMessage(result);
		}
	});
	sortedSetConsumer.setCleaner({ executionkey, key })
};

run();